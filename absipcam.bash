#!/bin/bash

# absipcam.bash   version 0.1, ¬© 2024 by Sergey Vasiliev aka abs.
# absipcam.bash - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –æ–±—ä—ë–º–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤, –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –æ—Ç –∫–∞–º–µ—Ä –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏–ª–∏ –æ–±—ä—ë–º–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º absmsg.bash). –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∂—É—Ä–Ω–∞–ª–µ.
# 
# absipcam.bash comes with ABSOLUTELY NO WARRANTY. This is free software, and you are welcome to redistribute it under certain conditions.  See  the GNU General Public Licence for details.
# 
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: absipcam.bash [–û–ü–¶–ò–Ø] ...
# 
# –û–ø—Ü–∏–∏:
# -a, --only-alarm    –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏–ª–∏ –æ–±—ä—ë–º–æ–º –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤
# -e, --email         –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ
# -s, --sms           –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –°–ú–°
# -q, --quiet         –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —ç–∫—Ä–∞–Ω
# -h, --help          –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç—É –ø–æ–¥—Å–∫–∞–∑–∫—É



# *************************************************************************************************************************************************************
# * –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤ —Ç–æ–º —á–∏—Å–ª–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)
# *************************************************************************************************************************************************************

# –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ __this —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
declare -A __this

# –ü—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏ —Å –∏–º–µ–Ω–∞–º–∏ –∫–∞–º–µ—Ä
declare -r path_to_videos="/home/vasiliev-s/.–∫–∞–º–µ—Ä—ã/video"

# –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä
declare -a -r ipcam_names=( IPBUH1Y IPBUH2V IPRSC_CH1Y IPRSC_CH2V IPRSC_TE1Y IPRSC_TE2V IPSK1Y IPSK2V )

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–≤–æ–≥–∏
declare -i -r min_total_size=1900		# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—É–º–º–∞—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ (–≤ MiB) –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –ø–æ –æ–¥–Ω–æ–π –∫–∞–º–µ—Ä–µ
declare -i -r min_total_count=96		# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –ø–æ –æ–¥–Ω–æ–π –∫–∞–º–µ—Ä–µ (4 –≤–∏–¥–µ–æ –≤ —á–∞—Å)
declare -i -r max_delta_of_size=-20		# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∑–∞ –Ω–µ–¥–µ–ª—é –¥–ª—è —Å—É–º–º–∞—Ä–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞    –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤
declare -i -r max_delta_of_count=-20	# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∑–∞ –Ω–µ–¥–µ–ª—é –¥–ª—è —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤

# –ü—É—Ç—å –∫ absmsg.bash
declare -r path_to_absmsg="/home/share/install/scripts/absmsg.bash"



# *************************************************************************************************************************************************************
# * –§—É–Ω–∫—Ü–∏–∏ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ)
# *************************************************************************************************************************************************************

# -----------------------------------------------------------------------------
# –§—É–Ω–∫—Ü–∏—è get_os
# –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ—Å—Ç–∞
#
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã: –Ω–µ—Ç
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ stdout: –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ—Å—Ç–∞
# -----------------------------------------------------------------------------
function get_os {
	local os=$(hostnamectl | grep 'Operating System: ' | awk '{print $3}')
	if [[ "$os" == "Ubuntu" ]]; then
		echo "ubuntu"
	elif [[ "$os" == "Fedora" ]]; then
		echo "fedora"
	else
		echo "$os"
	fi
	return 0
} # get_os

# -----------------------------------------------------------------------------
# –§—É–Ω–∫—Ü–∏—è spinner
# –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –≤—ã–≤–æ–¥–∏—Ç –≤—Ä–∞—â–∞—é—â—É—é—Å—è –ø–∞–ª–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω
#
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã: –Ω–µ—Ç
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ: –Ω–µ—Ç
# -----------------------------------------------------------------------------
function spinner {
	local i=1
	local -r symbols="/-\|"
	echo -n ' '
	while [[ true ]]; do
		printf "\b${symbols:i++%${#symbols}:1}"
		sleep .1
	done
} # spinner



# *************************************************************************************************************************************************************
# * –§—É–Ω–∫—Ü–∏–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–¥–∞—á —Ç–µ–∫—É—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
# *************************************************************************************************************************************************************

# -----------------------------------------------------------------------------
# –§—É–Ω–∫—Ü–∏—è init_variables
# –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ –º–∞—Å—Å–∏–≤ _this
#
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã: –Ω–µ—Ç
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –Ω–µ—Ç
# -----------------------------------------------------------------------------
function init_variables {
	__this[hostname]=$(hostname)					# –ò–º—è —Ö–æ—Å—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç
	__this[path]=$(readlink -f $(dirname $0))		# –ü—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Å–∫—Ä–∏–ø—Ç—É
	__this[filename]=$(basename $0)					# –ò–º—è —Ñ–∞–π–ª–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
	__this[os]="$(get_os)"							# –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∞—à–∏–Ω—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç
	__this[username]=$(whoami)						# –ò–º—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ
	return 0
} # init_variables

# -----------------------------------------------------------------------------
# –§—É–Ω–∫—Ü–∏—è main
# –≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞
#
# –ê—Ä–≥—É–º–µ–Ω—Ç—ã: —Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
# 0 - –Ω–µ—Ç –æ—à–∏–±–æ–∫
# 100 - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç —Ä–∞–±–æ—Ç–∞ —Å–∫—Ä–∏–ø—Ç–∞
# 101 - —Å–∫—Ä–∏–ø—Ç absmsg.bash –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞
# 102 - –æ—à–∏–±–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ getopt –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main
# 103 - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main, –≤–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–ª–∞–¥–∫–∞
# 104 - –æ—à–∏–±–∫–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
# 105 - –±—ã–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–∞–º–µ—Ä
# -----------------------------------------------------------------------------
function main {

	# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç–∞
	# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	init_variables

	# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ –ø–∞–∫–µ—Ç–æ–≤ sendemail, jq (—Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã absmsg.bash) –∏ absmsg.bash
	# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	if [[ -z "$(which sendemail 2>/dev/null)" ]]; then
		echo "–†–∞–±–æ—Ç–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞, —Ç.–∫. –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç sendemail."
		[[ ${__this[os]} == "fedora" ]] && echo "sudo dnf install sendemail"
		[[ ${__this[os]} == "ubuntu" ]] && echo "sudo apt install sendemail"

		# 100 - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç —Ä–∞–±–æ—Ç–∞ —Å–∫—Ä–∏–ø—Ç–∞
		return 100
	fi
	if [[ -z "$(which jq 2>/dev/null)" ]]; then
		echo "–†–∞–±–æ—Ç–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞, —Ç.–∫. –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç jq."
		[[ ${__this[os]} == "fedora" ]] && echo "sudo dnf install jq"
		[[ ${__this[os]} == "ubuntu" ]] && echo "sudo apt install jq"

		# 100 - –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç —Ä–∞–±–æ—Ç–∞ —Å–∫—Ä–∏–ø—Ç–∞
		return 100
	fi

	if [[ ! -x "${__this[path]}/absmsg.bash" ]]; then
		# 101 - —Å–∫—Ä–∏–ø—Ç absmsg.bash –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞
		echo "–û—à–∏–±–∫–∞ c–∫—Ä–∏–ø—Ç absmsg.bash –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞"
		echo "–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —Å –∫–æ–¥–æ–º 101"
		return 101
	fi


	# 3. –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
	# ~~~~~~~~~~~~~~~~~~~~~~~~~~~
	local -A opt

	# –í $temp –ø–æ–º–µ—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–∫—Ä–∏–ø—Ç–∞.
	# –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (–¥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ "--" ) –±—É–¥—É—Ç –ø–æ–º–µ—â–µ–Ω—ã –≤ –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - –ø–æ—Å–ª–µ.
	local temp
	temp=$(getopt --options 'aehsq' --longoptions 'only-alarm,email,help,sms,quiet' --name "${__this[filename]}" -- "$@")
	if [[ $? -ne 0 ]]; then
		# 102 - –æ—à–∏–±–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ getopt –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main
		echo "–û—à–∏–±–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ getopt –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main"
		echo "–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —Å –∫–æ–¥–æ–º 102"
		return 102
	fi

	# –ó–∞–º–µ—â–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ main –Ω–∞ –Ω–æ–≤—ã–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $temp
	eval set -- "$temp"
	unset temp

	# –í —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
	while true; do
		case "$1" in
			'-a'|'--only-alarm')
				opt[only_alarm]=true
				shift
				continue
			;;
			'-e'|'--email')
				opt[email]=true
				shift
				continue
			;;
			'-h'|'--help')
				opt[help]=true
				shift
				continue
			;;
			'-s'|'--sms')
				opt[sms]=true
				shift
				continue
			;;
			'-q'|'--quiet')
				opt[quiet]=true
				shift
				continue
			;;
			'--')
				# "--" - –∫–æ–Ω–µ—Ü –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
				shift
				break
			;;
			*)
				# 103 - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main, –≤–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–ª–∞–¥–∫–∞
				echo "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ main, –≤–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–ª–∞–¥–∫–∞"
				echo "–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —Å –∫–æ–¥–æ–º 103"
				return 103
			;;
		esac
	done

	# –ï—Å–ª–∏ –±—ã–ª–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–∞ –ø–æ–º–æ—â—å (–∏–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏)
	if [[ -n "${opt[help]}" || $# -ne 0 ]]; then
		echo "${__this[filename]}   version 0.1, ¬© 2024 by Sergey Vasiliev aka abs."
		echo "${__this[filename]} - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –æ–±—ä—ë–º–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤, –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –æ—Ç –∫–∞–º–µ—Ä –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏–ª–∏ –æ–±—ä—ë–º–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º absmsg.bash). –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∂—É—Ä–Ω–∞–ª–µ."
		echo ""
		echo "${__this[filename]} comes with ABSOLUTELY NO WARRANTY. This is free software, and you are welcome to redistribute it under certain conditions.  See  the GNU General Public Licence for details."
		echo ""
		echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ${__this[filename]} [–û–ü–¶–ò–Ø] ..."
		echo ""
		echo "–û–ø—Ü–∏–∏:"
		echo "-a, --only-alarm    –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏–ª–∏ –æ–±—ä—ë–º–æ–º –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤"
		echo "-e, --email         –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ"
		echo "-s, --sms           –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –°–ú–°"
		echo "-q, --quiet         –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —ç–∫—Ä–∞–Ω"
		echo "-h, --help          –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç—É –ø–æ–¥—Å–∫–∞–∑–∫—É"

		# –ë—ã–ª–∞ –æ—à–∏–±–∫–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
		if [[ $# -ne 0 ]]; then
			echo ""
			echo ""
			echo "–û—à–∏–±–∫–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏: ${@}"
			echo "–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —Å –∫–æ–¥–æ–º 104"

			# 104 - –æ—à–∏–±–∫–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
			return 104
		fi

		return 0
	fi


	# 4. –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å
	# ~~~~~~~~~~~~~~~~~

	# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
	if [[ -z "${opt[quiet]}" ]]; then
		local spinner_pid
		spinner &
		spinner_pid=$!
	fi

	# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
	local -A size_of_videos				# –°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –ø–æ –¥–Ω—è–º
	local -A count_of_videos			# –°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –ø–æ –¥–Ω—è–º
	local -A delta_of_size				# –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ –æ–±—â–µ–º —Ä–∞–∑–º–µ—Ä–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –ø–æ –¥–Ω—è–º
	local -A delta_of_count				# –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ –æ–±—â–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –ø–æ –¥–Ω—è–º
	local -a alarm_yesterday			# –°–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –≤—á–µ—Ä–∞
	local -a alarm_today				# –°–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
	local -A alarm=( [type]="info" )	# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
	local -a message					# –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∏/–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
	local ipcam
	local i

	# -----------------------------------------------------------------------------
	# –§—É–Ω–∫—Ü–∏—è ipcam_check_values
	# –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞—Ö size_of_videos, —Åount_of_videos,
	# delta_of_size –∏ delta_of_count –ø–æ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–º—É –∏–Ω–¥–µ–∫—Å—É $2 –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ
	# –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
	# $1 - –º–∞—Å—Å–∏–≤, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–±–∞–≤—è—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
	# $2 - –∏–Ω–¥–µ–∫—Å –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
	# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
	# –º–∞—Å—Å–∏–≤ "$1" —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–∫–∏ —Å —Ç—Ä–µ–≤–æ–∂–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
	# -----------------------------------------------------------------------------
	function ipcam_check_values {
		local -n arr="$1"
		local delta1
		local delta2

		printf -v delta1 "%.0f" ${delta_of_size["$2"]}
		printf -v delta2 "%.0f" ${delta_of_count["$2"]}

		[[ ${size_of_videos["$2"]}  -lt $min_total_size  ]] && printf -v 'arr["${#arr[@]}"]' "c—É–º–º–∞—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ (%u –ú–∏–ë) –º–µ–Ω—å—à–µ –¥–æ–ø—É—Å—Ç–∏–º–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ (%u –ú–∏–ë)" ${size_of_videos["$2"]} $min_total_size
		[[ ${count_of_videos["$2"]} -lt $min_total_count ]] && printf -v 'arr["${#arr[@]}"]' "—á–∏—Å–ª–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ (%u) –º–µ–Ω—å—à–µ –¥–æ–ø—É—Å—Ç–∏–º–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ (%u)" ${count_of_videos["$2"]} $min_total_count
		[[ $delta1 -lt $max_delta_of_size  ]] && printf -v 'arr["${#arr[@]}"]' "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —Å—É–º–º–∞—Ä–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ (%+06.2f%%), —á—Ç–æ –Ω–∏–∂–µ –ø—Ä–µ–¥–µ–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ (%s%%)"    ${delta_of_size["$2"]}  $max_delta_of_size
		#[[ $delta2 -lt $max_delta_of_count ]] && printf -v 'arr["${#arr[@]}"]' "–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ (%+06.2f%%), —á—Ç–æ –Ω–∏–∂–µ –ø—Ä–µ–¥–µ–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ (%s%%)" ${delta_of_count["$2"]} $max_delta_of_count

		return 0
	} # ipcam_check_values

	# -----------------------------------------------------------------------------
	# –§—É–Ω–∫—Ü–∏—è ipcam_echo_info
	# –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–π –∫–∞–º–µ—Ä–µ –≤ stdout –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
	# –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞ –∏ –æ–ø—Ü–∏–π –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
	# –ê—Ä–≥—É–º–µ–Ω—Ç—ã: –Ω–µ—Ç
	# –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
	# –≤ stdout –≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –∫–∞–º–µ—Ä–µ
	# -----------------------------------------------------------------------------
	function ipcam_echo_info {

		if [[ -z "${opt[only_alarm]}" || -n "${alarm[status]}" ]]; then
			echo "–ö–∞–º–µ—Ä–∞ ${ipcam}${alarm[status]}"
		fi
		if [[ -z "${opt[only_alarm]}" ]]; then
			printf " –≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞ –Ω–µ–¥–µ–ª—é –≤ –¥–µ–Ω—å . %3u –≤–∏–¥–µ–æ –Ω–∞ %3u –ú–∏–ë\n"                                     ${count_of_videos[average]}       ${size_of_videos[average]}
			printf " –≤—á–µ—Ä–∞ ...................... %3u –≤–∏–¥–µ–æ –Ω–∞ %3u –ú–∏–ë (%+06.2f%% –∏ %+06.2f%% –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ)\n" ${count_of_videos[yesterday]}     ${size_of_videos[yesterday]}     ${delta_of_count[yesterday]}     ${delta_of_size[yesterday]}
			printf " c–µ–≥–æ–¥–Ω—è .................... %3u –≤–∏–¥–µ–æ –Ω–∞ %3u –ú–∏–ë\n"                                     ${count_of_videos[today]}         ${size_of_videos[today]}
			printf " ~ –±—É–¥–µ—Ç –∫ –∫–æ–Ω—Ü—É –¥–Ω—è ........ %3u –≤–∏–¥–µ–æ –Ω–∞ %3u –ú–∏–ë (%+06.2f%% –∏ %+06.2f%% –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ)\n" ${count_of_videos[extrapolation]} ${size_of_videos[extrapolation]} ${delta_of_count[extrapolation]} ${delta_of_size[extrapolation]}
			echo ""
		fi
		if [[ ${#alarm_today[@]} -gt 0 ]]; then
			if [[ ${#alarm_yesterday[@]} -gt 0 ]]; then
				echo " —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—á–µ—Ä–∞:"
				for i in "${alarm_yesterday[@]}"; do
					echo "  - ${i}"
				done
			fi
			echo " —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è (–Ω–∞ –∫–æ–Ω–µ—Ü –¥–Ω—è):"
			for i in "${alarm_today[@]}"; do
				echo "  - ${i}"
			done
			echo ""
		fi

		return 0
	} # ipcam_echo_info
	# -----------------------------------------------------------------------------

	for ipcam in "${ipcam_names[@]}"; do

		# –û–±–Ω—É–ª—è–µ–º –º–∞—Å—Å–∏–≤—ã —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
		alarm_yesterday=()
		alarm_today=()
		alarm[status]=""

		# –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π, –∑–∞ –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å –∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è: –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö —á–∏—Å–ª–æ
		size_of_videos=(
			[average]=$(( $(find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime -9 -mtime +1 | xargs ls --size --block-size=1 | awk '{print $1}' | paste -s -d '+' | bc) / 7 ))
			[yesterday]=$(  find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime -2 -mtime +0 | xargs ls --size --block-size=1 | awk '{print $1}' | paste -s -d '+' | bc)
			[today]=$(      find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime 0            | xargs ls --size --block-size=1 | awk '{print $1}' | paste -s -d '+' | bc)
			[extrapolation]=""
		)
		count_of_videos=(
			[average]=$(( $(find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime -9 -mtime +1 | wc -l) / 7 ))
			[yesterday]=$(  find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime -2 -mtime +0 | wc -l)
			[today]=$(      find "${path_to_videos}/${ipcam}" -maxdepth 1 -type f -daystart -mtime 0 | wc -l)
			[extrapolation]=""
		)
		delta_of_size=(
			[yesterday]=$( bc <<< "scale=2; ${size_of_videos[yesterday]} * 100 / ${size_of_videos[average]} - 100" )
			[extrapolation]=""
		)
		delta_of_count=(
			[yesterday]=$(( count_of_videos[yesterday] * 100 / count_of_videos[average] - 100 ))
			[extrapolation]=""
		)

		# –ü–µ—Ä–µ–≤–æ–¥ –∏–∑ –±–∞–π—Ç–æ–≤ –≤ –º–µ–≥–∞–±–∞–π—Ç—ã
		(( size_of_videos[average] /= 1024*1024 ))
		(( size_of_videos[yesterday] /= 1024*1024 ))
		(( size_of_videos[today] /= 1024*1024 ))

		# –≠–∫—Å—Ç—Ä–∞–ø–æ–ª–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è, –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç [—á–∏—Å–ª–æ_—Å–µ–∫—É–Ω–¥_–≤_—Å—É—Ç–∫–∞—Ö]/[—á–∏—Å–ª–æ_—Å–µ–∫—É–Ω–¥_—Å_–Ω–∞—á–∞–ª–∞_—Å—É—Ç–æ–∫]
		i=$( bc <<< "scale=2; 86400 / ( $(date +%s) - $(date -d 'today 00:00:00' +%s) )")

		size_of_videos[extrapolation]=$(  bc <<< "scale=2; ${size_of_videos[today]}  * ${i}" )
		count_of_videos[extrapolation]=$( bc <<< "scale=2; ${count_of_videos[today]} * ${i}" )

		size_of_videos[extrapolation]="${size_of_videos[extrapolation]%.*}"
		count_of_videos[extrapolation]="${count_of_videos[extrapolation]%.*}"

		delta_of_size[extrapolation]=$( bc <<< "scale=2; ${size_of_videos[extrapolation]} * 100 / ${size_of_videos[average]} - 100" )
		delta_of_count[extrapolation]=$( bc <<< "scale=2; ${count_of_videos[extrapolation]} * 100 / ${count_of_videos[average]} - 100" )

		# –£ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π, –º–µ–Ω—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –Ω–∞ –∑–∞–ø—è—Ç—É—é
		delta_of_count[yesterday]=${delta_of_count[yesterday]//./,}
		delta_of_size[yesterday]=${delta_of_size[yesterday]//./,}
		delta_of_count[extrapolation]=${delta_of_count[extrapolation]//./,}
		delta_of_size[extrapolation]=${delta_of_size[extrapolation]//./,}

		# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è
		ipcam_check_values "alarm_yesterday" "yesterday"
		ipcam_check_values "alarm_today" "extrapolation"

		# –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –±—ã–ª–∏ –ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ, –∏–ª–∏ –±—ã–ª–∏ –µ—â—ë –∏ –≤—á–µ—Ä–∞, —Ñ–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ alarm
		if [[ ${#alarm_today[@]} -gt 0 ]]; then
			[[ -n ${alarm[ipcams]} ]] && alarm[ipcams]+=", "
			alarm[ipcams]+="$ipcam"

			if [[ ${#alarm_yesterday[@]} -gt 0 ]]; then
				# –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–∞–º–µ—Ä–æ–π –±—ã–ª–∞ –≤—á–µ—Ä–∞ –∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è
				alarm[type]="error"
				alarm[status]=": –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø! –ü–†–û–ë–õ–ï–ú–´ –° –ó–ê–ü–ò–°–¨–Æ –í–ò–î–ï–û –û–¢ –ö–ê–ú–ï–†–´!"
				alarm[ipcams]+=" (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)"
			else
				# –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–∞–º–µ—Ä–æ–π –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è, –≤—á–µ—Ä–∞ –≤—Å—ë –±—ã–ª–æ —Ö–æ—Ä–æ—à–æ
				[[ "${alarm[type]}" != "error" ]] && alarm[type]="warning"
				alarm[status]=": —Å–µ–≥–æ–¥–Ω—è ($(date +'%F')) –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–º"
			fi
		fi

		# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏–º –≤—ã–≤–æ–¥ –æ –∫–∞–º–µ—Ä–µ –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
		mapfile -t -O ${#message[@]} message < <(ipcam_echo_info)
	done

	# –§–æ—Ä–º–∏—Ä—É–µ–º alarm[ipcams] - —ç—Ç–æ —Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ email –∏/–∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –°–ú–° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
	if [[ -z ${alarm[ipcams]} ]]; then
		# –ï—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–≤–æ–≥
		alarm[ipcams]="–ü–æ—Ö–æ–∂–µ, —á—Ç–æ –≤—Å–µ –∫–∞–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ."
		[[ -n "${opt[only_alarm]}" ]] && message=( "${alarm[ipcams]}" "" )
		alarm[ipcams]="–ö–ê–ú–ï–†–´ $(date +'%F') | ${alarm[ipcams]}"
	else
		# –ë—ã–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
		alarm[ipcams]="–ö–ê–ú–ï–†–´ $(date +'%F') | –ü—Ä–æ–±–ª–µ–º—ã: ${alarm[ipcams]}."
		[[ "${alarm[type]}" == "warning" ]] && alarm[ipcams]="‚ö† ${alarm[ipcams]}"
		[[ "${alarm[type]}" == "error"   ]] && alarm[ipcams]="‚ùó ${alarm[ipcams]}"
	fi

	# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
	if [[ -z "${opt[quiet]}" ]]; then
		kill $spinner_pid
		wait $spinner_pid 2>/dev/null
		printf "\b"
	fi

	# –í—ã–≤–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω, —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É –∏ –°–ú–°, –∑–∞–ø–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª
	[[ -z "${opt[quiet]}" ]] && printf "%s\n" "${message[@]}"
	[[ -n "${opt[email]}" && ( "${alarm[type]}" != "info" || -z "${opt[only_alarm]}" ) ]] && printf "%s\n" "${message[@]}" | "${__this[path]}/absmsg.bash" --email --subject "${alarm[ipcams]}"
	[[ -n "${opt[sms]}"   &&   "${alarm[type]}" != "info" ]]                              && echo "${alarm[ipcams]}" | "${__this[path]}/absmsg.bash" --sms

	# –§–∏–∫—Å–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–º–µ—Ä–∞—Ö –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª
	printf "%s\n%s\n" "--------------------" "${message[@]}" | logger -t ""${__this[filename]}"" --priority "user.${alarm[type]}" --

	# 105 - –±—ã–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–∞–º–µ—Ä
	[[ "${alarm[type]}" != "info" ]] && return 105

	return 0
} # main



# *************************************************************************************************************************************************************
# * –°–∞–º —Å–∫—Ä–∏–ø—Ç üòä
# *************************************************************************************************************************************************************

main "$@"
exit $?

# *************************************************************************************************************************************************************
